## 3.3 代理服务配置

主要是对动态脱敏任务的管理，如添加、修改、查看详情等。

#### 3.3.1 添加任务

点击“添加”按钮后进入代理数据库配置界面。

![](/images/operation/rule/ddm/ddm_8.png)

添加和选择如下信息：

| 任务名称     | Test123                               |
| ------------ | ------------------------------------- |
| 数据源类型   | oracle（默认）                        |
| 数据源       | oracle11g（根据需要从源数据库中选择） |
| 代理用户     | user（从代理服务账号中选择）          |
| 最小连接数   | 1                                     |
| 最大连接数   | 8                                     |
| 返回行数限制 | 100（非必填）                         |
| 选择时间     | （每天）10:00-16:00                   |

a. 数据源类型：根据数据库的类型做分类。

b. 数据源：数据源中仅可对源数据库模块中审核通过并且表结构更新状态位已完成的源数据库进行选择。

c. 代理用户：来自于代理服务账号，可以单选也可以多选。

d.选择时间：在选定的时间段内可以使用动态代理服务，非选定的时间内代理服务不可用。

点击“下一步”，选择要脱敏的表和字段。

![](/images/operation/rule/ddm/ddm_9.png)

点击“下一步”，选择该动态脱敏作业的全局脱敏规则，字段规则非必选项。

![](/images/operation/rule/ddm/ddm_10.png)

a. 应用规则组：此功能的前提是该数据库进行了敏感数据扫描的操作，应用规则组只可给匹配上了敏感类型的字段应用对应敏感类型的脱敏规则。系统中内置5种规则组，也可应用自定义的规则组

点击“下一步”，进入账号自定义及黑白名单配置，账号自定义和黑白名单非必填项，根据实际需要进行相应的配置。点击“完成”即可完成动态代理任务的添加。

![](/images/operation/rule/ddm/ddm_11.png)

a. 账号自定义：点击账号自定义在弹出的账号自定义界面，选择账号类型，可选择代理用户或者应用层账号，选择账号和规则名称点击“添加”后点击“完成”按钮，则完成账号自定义的添加。此功能可实现对不用的账号应用不同的脱敏规则。

![](/images/operation/rule/ddm/ddm_12.png)

b. 黑白名单：点击黑白名单在弹出的黑白名单添加页面，可添加黑白名单关键词。在黑名单关键词输入框中输入指定的关键词点击“添加”，即可添加一个黑名单。白名单添加方式和黑名单一样。点击“确定”，即可对该表的字段成功添加自定义的黑白名单。

![](/images/operation/rule/ddm/ddm_13.png)

a. 账号信息-查看详情：在此可以查看到该任务中配置的自定义账号的信息

b. 黑白名单-查看详情：在此可以查看到该任务中配置的黑白名单的信息；匹配上黑名单的数据则查询不会显示该行数据，匹配上白名单的数据则该行数据不会进行脱敏，如果同一个关键词同时出现在黑名单和白名单中则以黑名单为准。

添加成功后仅任务审核通过后，任务才可被启动。

![](/images/operation/rule/ddm/ddm_14.png)

#### 3.3.2 修改和删除

当动态脱敏任务没有进行的时候任务才可以修改，点击修改按钮即可跳转到动态脱敏任务修改页面，修改项除了代理服务名，数据源不可修改外，其余数据均可以进行修改。在一个任务修改完成后其审核状态会变更为未审核，重新审核才可启动任务。

![](/images/operation/rule/ddm/ddm_15.png)

选中任务前面的复选框点击删除按钮，可以对任务进行删除操作，开启的任务不可删除、不可修改，只可停止或者查看动态脱敏任务详情。

![](/images/operation/rule/ddm/ddm_16.png)

#### 3.3.3 更多操作

点击操作一栏中的详情按钮查看该脱敏任务的配置信息。可以点开下拉框图标展示该表和字段的脱敏配置详细信息。

![](/images/operation/rule/ddm/ddm_17.png)

搜索：用户可以再搜索框输入内容对任务名称进行模糊搜索。

![](/images/operation/rule/ddm/ddm_18.png)

筛选：用户可以通过对表头的数据库类型、状态和审核状态进行筛选。选择类型之后点击“筛选”即可。点击“重置”则回到默认状态。

![](/images/operation/rule/ddm/ddm_19.png)

#### 3.3.4 代理数据库的连接

在代理数据库配置页面添加了代理数据库并启用后，使用工具连接代理数据库（推荐Navicat）。打开Navicat工具，新建一个连接，类型选择MySQL，连接的配置信息如下，连接成功后，点击页面的新建查询，使用sql语句查询配置了规则的敏感表则可以查看到脱敏后的数据。

![](/images/operation/rule/ddm/ddm_20.png)

a. 主机名或IP地址：脱敏设备的IP地址

b. 端口：端口为设备的代理服务端口，固定为8066

c. 用户名：用户名是添加代理数据库配置的第一步中选择的代理用户

d. 密码：添加代理用户时设置的密码
